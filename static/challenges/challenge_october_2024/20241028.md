---
date: 2024-10-28
impressions: 3224
reactions: 55
comments: 14
shares: 2
followers: 36
tags: NodeJS CyberSecurity OctoberChallenge
---

# ğŸ‘¿ "Mon API est en HTTPS, je n'ai pas besoin de protection CSRF, c'est secure !"

Cette phrase, je l'ai entendue tellement de fois... et pourtant.

Le CSRF (Cross-Site Request Forgery), c'est quand un site malveillant force ton navigateur Ã  faire des requÃªtes vers une API oÃ¹ tu es dÃ©jÃ  authentifiÃ©, en utilisant tes cookies de session.

## Un jour on m'a demandÃ© comment rÃ©aliser une attaque CSRF sur une API NodeJS, voici 3 erreurs qui t'exposent :

1ï¸âƒ£ Faire confiance au header Origin/Referer

- Facilement manipulable cÃ´tÃ© client
- Parfois absent (politique de confidentialitÃ© du navigateur)
- Peut Ãªtre bloquÃ© par des proxy

2ï¸âƒ£ Utiliser uniquement un token dans le localStorage

- VulnÃ©rable aux attaques XSS
- Pas de protection contre les requÃªtes automatiques
- Fausse sensation de sÃ©curitÃ©

3ï¸âƒ£ Se fier Ã  un token CSRF stockÃ© en cookie sans le vÃ©rifier dans le body

- Le cookie voyage automatiquement
- Aucune validation cÃ´tÃ© serveur
- Protection inexistante contre les requÃªtes forgÃ©es

## ğŸ˜± Sauf qu'un jour, c'est dans une de mes API pour un projet perso que j'ai retrouvÃ© le problÃ¨me.

J'avais mis en place l'authentification (trop) vite fait pour gagner du temps (jwt, local storage).

RÃ©sultat : aucune consÃ©quence utilisateur (puisqu'il n'y avait que moi) mais beaucoup de temps perdu.

ğŸ› ï¸ Une solution possible ?

- Synchonizer Token Pattern
- SameSite cookies
- Signed Double Submit Cookie Pattern

- Mettre en place un outil d'analyse de sÃ©cu (j'utilise la CLI open source de Snyk par exemple).

(Tu peux aussi Ã©viter tout ce qui est liÃ© aux cookies mais c'est un autre sujet).

## ğŸ§  Ne nÃ©glige jamais les bases de sÃ©curitÃ© et ne te crois pas Ã  l'abri d'une erreur triviale.

La sÃ©curitÃ©, c'est comme le typage ou les tests auto : mieux vaut Ãªtre explicite que supposer et mieux vaut douter que merder

ğŸ™ï¸ Et toi, Ã  quelle erreur de niveau "maternelle++" t'es-tu fait prendre (alors que tu maÃ®trisais le sujet) ?

---

PS : HTTPS "aide" mÃªme les attaquants CSRF car leurs requÃªtes sont aussi chiffrÃ©es et donc plus difficiles Ã  dÃ©tecter !

---

Tu me dÃ©couvres ou me redÃ©couvres avec ce post ?

ğŸ› ï¸ Pendant tout le mois d'octobre, je publie un post par jour autour de NodeJS, TypeScript et d'Architecture Logicielle.

#NodeJS #CyberSecurity #OctoberChallenge
