---
date: 2024-10-30
impressions: 670
reactions: 9
comments: 7
shares: 0
followers: 10
tags: Refactoring SoftwareArchitecture OctoberChallenge
---

# üå≥ Comment refactorer du code spaghetti sans tout casser et pour continuer d'avancer...?

Il y a quelques ann√©es, sur un projet bien legacy (mais vraiment bien legacy), on √©tait compl√®tement bloqu√© !

Pourtant il fallait avancer sur une nouvelle fonctionnalit√© indispensable pour le produit de notre client.

Mais, on avait r√©cup√©r√© et accumul√© de la dette avec les sympt√¥mes habituels : trop de couplage, trop de d√©pendances implicites, trop d'effets de bords incontr√¥lables.

## ü§î Comment s'en sortir ?

Apr√®s pas mal de recherches, on est tomb√© sur la photo (bien connue) d'un arbre australien (que j'ai repris pour ce post).

√áa m'a rappel√© des trucs √©voqu√©s √† la fac : le Strangler Fig Pattern de Martin Fowler.

## üß† L'id√©e ? Comme ce figuier qui s'enroule autour d'un arbre jusqu'√† l'asphyxier et le remplacer, on wrap notre code legacy avec du nouveau code jusqu'√† pouvoir retirer l'ancien.

## üõ†Ô∏è Voici la recette qu'on a suivie (avec quelques ajouts depuis) :

1Ô∏è‚É£ Analyse l'existant : fais l'inventaire des d√©pendances et des effets de bords, identifie les diff√©rents blocs logique √† d√©coupler et surtout Snapshot le comportement existant (Golden Master par exemple).

2Ô∏è‚É£ Cr√©e une abstraction avec le Facade Pattern (lien en commentaire) pour isoler et faire √©voluer le code √† refactorer, assure-toi de mettre en place des tests auto pour valider le comportement au fur et √† mesure que tu avances.

3Ô∏è‚É£ Cr√©e et extraits les nouveaux composants petit √† petit gr√¢ce √† tes tests qui t'assurent les bon reg.

4Ô∏è‚É£ Valide en condition r√©elle (avec des features flags pour une partie des utilisateurs, par exemple) que tout est ok sur une dur√©e pertinente et repr√©sentative.

5Ô∏è‚É£ Nettoie le bouzin : supprime le code legacy non utilis√©, simplifie la fa√ßade qui devient un simple adaptateur (Adapter Pattern), les tests documentent le comportement.

## üéâ Le meilleur dans tout √ßa ?

Quand le nouveau CTO du client, arriv√© entre temps, a f√©licit√© l'√©quipe en reconnaissant le pattern : "Oh un Strangler, bravo. Je vais m'amuser √† remonter l'historique git du coup !".

On est pass√© d'une situation d√©sesp√©rante √† un franc succ√®s pour tout le monde : upsell sur une seconde mission pour nous, level up de l'√©quipe, satisfaction client et d'√©normes √©conomies par rapport √† une refonte.

### ‚ö†Ô∏è A ne pas oublier :

- plus c'est restreint et mieux c'est.
- les tests ne sont pas en option.
- compare syst√©matiquement l'ancien et le nouveau code.
- pr√©vois le pire avec une strat√©gie de rollback.

üéôÔ∏è As-tu d√©j√† utilis√© cette approche ? Ou as-tu d'autres techniques de refactoring √† partager ?

---

Tu me d√©couvres ou me red√©couvres avec ce post ?

üõ†Ô∏è Pendant tout le mois d'octobre, je publie un post par jour autour de NodeJS, TypeScript et d'Architecture Logicielle.

#Refactoring #SoftwareArchitecture #OctoberChallenge
